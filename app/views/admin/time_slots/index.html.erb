<div style="max-width: 1400px; margin: 0 auto; padding: 2rem;">
  <!-- Header Section -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid rgba(79, 70, 229, 0.3);">
    <div>
      <h1 style="font-size: 2rem; font-weight: 700; color: #ffffff; margin-bottom: 0.5rem;">Manage Time Slots</h1>
      <p style="color: #9ca3af; font-size: 0.875rem;">Create and manage available reservation time slots</p>
    </div>
    <%= link_to new_admin_time_slot_path, 
        style: "background: linear-gradient(135deg, #4f46e5 0%, #818cf8 100%); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; text-decoration: none; font-weight: 600; box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3); transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem;",
        onmouseover: "this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 10px rgba(79, 70, 229, 0.4)';",
        onmouseout: "this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(79, 70, 229, 0.3)';" do %>
      <span style="font-size: 1.25rem;">+</span>
      <span>Add New Time Slot</span>
    <% end %>
  </div>

  <% if @time_slots.any? %>
    <div style="background: linear-gradient(135deg, rgba(31, 41, 55, 0.6) 0%, rgba(17, 24, 39, 0.6) 100%); border-radius: 0.75rem; border: 1px solid rgba(79, 70, 229, 0.2); overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);">
      <table style="width: 100%; border-collapse: collapse;">
        <thead style="background: linear-gradient(135deg, rgba(79, 70, 229, 0.2) 0%, rgba(79, 70, 229, 0.1) 100%);">
          <tr>
            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #e5e7eb; border-bottom: 1px solid rgba(79, 70, 229, 0.3);">DATE & TIME</th>
            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #e5e7eb; border-bottom: 1px solid rgba(79, 70, 229, 0.3);">TABLES</th>
            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #e5e7eb; border-bottom: 1px solid rgba(79, 70, 229, 0.3);">CAPACITY</th>
            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #e5e7eb; border-bottom: 1px solid rgba(79, 70, 229, 0.3);">RESERVED</th>
            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #e5e7eb; border-bottom: 1px solid rgba(79, 70, 229, 0.3);">STATUS</th>
            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #e5e7eb; border-bottom: 1px solid rgba(79, 70, 229, 0.3);">ACTIONS</th>
          </tr>
        </thead>
        <tbody>
          <% @time_slots.each do |time_slot| %>
            <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.2s;" onmouseover="this.style.backgroundColor='rgba(255, 255, 255, 0.03)';" onmouseout="this.style.backgroundColor='transparent';">
              <td style="padding: 1rem;">
                <div style="color: #e5e7eb; font-weight: 500;">
                  <%= time_slot.start_time.strftime("%b %d, %Y") %>
                </div>
                <div style="color: #9ca3af; font-size: 0.875rem;">
                  <%= time_slot.start_time.strftime("%l:%M %p") %>
                </div>
              </td>

              <td style="padding: 1rem;">
                <span style="font-weight: 700; color: #818cf8; font-size: 1.125rem;"><%= time_slot.max_tables %></span>
                <span style="color: #9ca3af; font-size: 0.875rem;"> tables</span>
              </td>

              <td style="padding: 1rem;">
                <span style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 9999px; background: linear-gradient(135deg, rgba(79, 70, 229, 0.2) 0%, rgba(129, 140, 248, 0.2) 100%); border: 1px solid rgba(129, 140, 248, 0.3); color: #a5b4fc; font-size: 0.875rem; font-weight: 500;">
                  Max <%= time_slot.table_capacity %>
                </span>
              </td>              
              <td style="padding: 1rem;">
                <span style="font-weight: 600; color: <%= time_slot.available? ? '#10b981' : '#ef4444' %>;"><%= time_slot.reservations.count %></span>
                <span style="color: #9ca3af; font-size: 0.875rem;"> reservations</span>
              </td>
              <td style="padding: 1rem;">
                <% if time_slot.available? %>
                  <span style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%); color: #6ee7b7; padding: 0.375rem 0.875rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 600; border: 1px solid rgba(16, 185, 129, 0.3);">
                    Available
                  </span>
                <% else %>
                  <span style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%); color: #fca5a5; padding: 0.375rem 0.875rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 600; border: 1px solid rgba(239, 68, 68, 0.3);">
                    Full
                  </span>
                <% end %>
              </td>
              <td style="padding: 1rem;">
                <div style="display: flex; gap: 1rem; align-items: center;">
                  <%= link_to "Modify", '#', 
                      style: "color: #818cf8; text-decoration: none; font-weight: 500; font-size: 0.875rem; transition: all 0.2s;",
                      onmouseover: "this.style.color='#a5b4fc';",
                      onmouseout: "this.style.color='#818cf8';",
                      onclick: "openModifyModal(#{time_slot.id}, '#{time_slot.start_time.strftime("%b %d, %Y at %l:%M %p")}', #{time_slot.max_tables}, #{time_slot.table_capacity}); return false;" %>
                  <%= button_to "Delete", admin_time_slot_path(time_slot), 
                      method: :delete, 
                      data: { turbo_confirm: "Are you sure you want to delete this time slot?" },
                      style: "background: none; border: none; padding: 0; color: #f87171; cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: all 0.2s;",
                      onmouseover: "this.style.color='#f87171';",
                      onmouseout: "this.style.color='#ef4444';" %>
                </div>
              </td>



              
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div style="text-align: center; padding: 4rem; background: linear-gradient(135deg, rgba(31, 41, 55, 0.6) 0%, rgba(17, 24, 39, 0.6) 100%); border-radius: 0.75rem; border: 1px solid rgba(79, 70, 229, 0.2);">
      <p style="color: #9ca3af; font-size: 1.125rem; margin-bottom: 1rem;">No time slots created yet.</p>
      <%= link_to new_admin_time_slot_path, 
          style: "background: linear-gradient(135deg, #4f46e5 0%, #818cf8 100%); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; text-decoration: none; font-weight: 600; display: inline-block;" do %>
        Create your first time slot
      <% end %>
    </div>
  <% end %>
</div>

<!-- Modify Time Slot Modal -->
<div id="modifyModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.75); z-index: 1000; align-items: center; justify-content: center;">
  <div style="background: linear-gradient(135deg, rgba(31, 41, 55, 0.98) 0%, rgba(17, 24, 39, 0.98) 100%); border-radius: 1rem; max-width: 500px; width: 90%; border: 2px solid rgba(79, 70, 229, 0.4); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);">
    <!-- Modal Header -->
    <div style="padding: 1.5rem 2rem; border-bottom: 1px solid rgba(79, 70, 229, 0.3); display: flex; justify-content: space-between; align-items: center;">
      <div>
        <h2 style="font-size: 1.5rem; font-weight: 700; color: #ffffff; margin-bottom: 0.25rem;">Modify Time Slot</h2>
        <p id="modalDateTime" style="color: #9ca3af; font-size: 0.875rem;"></p>
      </div>
      <button onclick="closeModifyModal()" style="background: none; border: none; color: #9ca3af; cursor: pointer; font-size: 1.5rem; padding: 0.5rem; transition: all 0.2s;" onmouseover="this.style.color='#ffffff';" onmouseout="this.style.color='#9ca3af';">
        âœ•
      </button>
    </div>
    
    <!-- Modal Body -->
    <div style="padding: 2rem;">
      <form id="modifyForm" onsubmit="return false;">
        <input type="hidden" id="timeSlotId" name="time_slot_id">
        
        <!-- Editable Fields -->
        <div style="margin-bottom: 1.5rem;">
          <label for="maxTables" style="display: block; font-weight: 500; margin-bottom: 0.5rem; color: #e5e7eb; font-size: 0.875rem;">
            Maximum Tables
          </label>
          <input type="number" id="maxTables" name="max_tables" min="1" required
                 style="width: 100%; border-radius: 0.5rem; background-color: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 0.75rem; color: #ffffff; font-size: 1rem;"
                 onfocus="this.style.borderColor='rgba(129, 140, 248, 0.5)'; this.style.backgroundColor='rgba(255, 255, 255, 0.08)';"
                 onblur="this.style.borderColor='rgba(255, 255, 255, 0.1)'; this.style.backgroundColor='rgba(255, 255, 255, 0.05)';">
          <p style="color: #9ca3af; font-size: 0.75rem; margin-top: 0.5rem;">
            Number of tables available for this time slot
          </p>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
          <label for="tableCapacity" style="display: block; font-weight: 500; margin-bottom: 0.5rem; color: #e5e7eb; font-size: 0.875rem;">
            Table Capacity
          </label>
          <input type="number" id="tableCapacity" name="table_capacity" min="1" required
                 style="width: 100%; border-radius: 0.5rem; background-color: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 0.75rem; color: #ffffff; font-size: 1rem;"
                 onfocus="this.style.borderColor='rgba(129, 140, 248, 0.5)'; this.style.backgroundColor='rgba(255, 255, 255, 0.08)';"
                 onblur="this.style.borderColor='rgba(255, 255, 255, 0.1)'; this.style.backgroundColor='rgba(255, 255, 255, 0.05)';">
          <p style="color: #9ca3af; font-size: 0.75rem; margin-top: 0.5rem;">
            Maximum number of people per table
          </p>
        </div>
        
        <!-- Action Buttons -->
        <div style="display: flex; gap: 0.75rem;">
          <button type="button" onclick="closeModifyModal()" 
                  style="flex: 1; padding: 0.75rem 1.5rem; border-radius: 0.5rem; color: #d1d5db; border: 1px solid rgba(255, 255, 255, 0.2); background: transparent; cursor: pointer; font-weight: 600; transition: all 0.2s;"
                  onmouseover="this.style.backgroundColor='rgba(255, 255, 255, 0.05)';"
                  onmouseout="this.style.backgroundColor='transparent';">
            Cancel
          </button>
          <button type="submit" 
                  style="flex: 1; padding: 0.75rem 1.5rem; border-radius: 0.5rem; background: linear-gradient(135deg, #4f46e5 0%, #818cf8 100%); color: #ffffff; border: none; cursor: pointer; font-weight: 600; box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3); transition: all 0.2s;"
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 10px rgba(79, 70, 229, 0.4)';"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(79, 70, 229, 0.3)';">
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function openModifyModal(timeSlotId, dateTime, maxTables, tableCapacity) {
  const modal = document.getElementById('modifyModal');
  
  // Set modal content
  document.getElementById('timeSlotId').value = timeSlotId;
  document.getElementById('modalDateTime').textContent = dateTime;
  document.getElementById('maxTables').value = maxTables;
  document.getElementById('tableCapacity').value = tableCapacity;
  
  // Show modal
  modal.style.display = 'flex';
  setTimeout(() => {
    modal.style.opacity = '1';
  }, 10);
}

function closeModifyModal() {
  const modal = document.getElementById('modifyModal');
  modal.style.opacity = '0';
  setTimeout(() => {
    modal.style.display = 'none';
  }, 200);
}

// Handle form submission
document.getElementById('modifyForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const timeSlotId = document.getElementById('timeSlotId').value;
  const maxTables = document.getElementById('maxTables').value;
  const tableCapacity = document.getElementById('tableCapacity').value;
  
  // Validate inputs
  if (parseInt(maxTables) < 1) {
    alert('Maximum tables must be at least 1');
    return;
  }
  
  if (parseInt(tableCapacity) < 1) {
    alert('Table capacity must be at least 1');
    return;
  }
  
  // Get CSRF token
  const csrfToken = document.querySelector('meta[name="csrf-token"]');
  if (!csrfToken) {
    console.error('CSRF token not found in page');
    alert('Security token not found. Please refresh the page.');
    return;
  }
  
  console.log('Sending update request for time slot:', timeSlotId);
  
  // Send update request
  fetch(`/admin/time_slots/${timeSlotId}`, {
    method: 'PATCH',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRF-Token': csrfToken.content,
      'Accept': 'application/json'
    },
    body: JSON.stringify({
      time_slot: {
        max_tables: maxTables,
        table_capacity: tableCapacity
      }
    })
  })
  .then(response => {
    console.log('Response status:', response.status);
    console.log('Response headers:', [...response.headers.entries()]);
    
    if (!response.ok) {
      return response.text().then(text => {
        console.error('Server response:', text);
        throw new Error(`Server error: ${response.status}`);
      });
    }
    return response.json();
  })
  .then(data => {
    console.log('Response data:', data);
    
    if (data.success) {
      closeModifyModal();
      // Reload the page to show updated data
      location.reload();
    } else {
      alert(data.error || 'Failed to update time slot');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Failed to update time slot: ' + error.message);
  });
});

// Close modal when clicking outside
document.getElementById('modifyModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeModifyModal();
  }
});

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const modal = document.getElementById('modifyModal');
    if (modal.style.display === 'flex') {
      closeModifyModal();
    }
  }
});

// Add transition for smooth fade
document.getElementById('modifyModal').style.transition = 'opacity 0.2s ease-in-out';
</script>